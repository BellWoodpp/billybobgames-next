<!DOCTYPE HTML>
<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DJ7PED4TRM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DJ7PED4TRM');
    </script>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>HTML5 Fly - Space Shooter</title>
   <link rel="icon" href="ship_icon.png">
   <style type="text/css">
   *{margin:0;padding:0;box-sizing:border-box;}
   html,body{height:100%;}
   body{
     background:#000;
     color:#fff;
     font-family: Arial,Helvetica,Sans-serif;
     display:flex;
     flex-direction:column;
     align-items:center;
     justify-content:center;
     overflow:hidden;
   }
   table{border-spacing:0;}
   #game-wrapper{display:flex;justify-content:center;width:100%;}
   canvas{border:1px solid #111;display:block;max-width:100%;height:auto;}
   a{
       color:#00aaff;
       outline:none;
       text-decoration:none;
   }

   a:hover {
       text-decoration:underline;
   }

   #dbg {
     font-family: "Helvetica", Arial, sans-serif;
     border: 1px solid #222;
     width: 600px;
     max-width: 100%;
     min-height: 32px;
     margin-top: 12px;
     padding: 8px 12px;
     background: rgba(0,0,0,0.45);
     color: #b3b3b3;
     text-align: center;
   }
   #hidden{visibility:hidden;width:1px;height:1px;overflow:hidden;}
   </style>

    <!---- javascript includes --->
    <!---- open license with citation to dougx.net--->
    <script type="text/javascript" src="Sound.js"> </script>

    <script type="text/javascript" src="Background.js"> </script>
    <script type="text/javascript" src="Mouse.js"> </script>
    <script type="text/javascript" src="Loader.js"> </script>
    <script type="text/javascript" src="FloatyText.js"> </script>
    <script type="text/javascript" src="Keyboard.js"> </script>
    <script type="text/javascript" src="Collision.js"> </script>

    <script type="text/javascript" src="AfterEffect.js"> </script>
    <script type="text/javascript" src="PeaShooter.js"> </script>
    <script type="text/javascript" src="Laser.js"> </script>
    <script type="text/javascript" src="LevelDirector.js"> </script>
    <script type="text/javascript" src="Sortie.js"> </script>
    <script type="text/javascript" src="Enemy.js"> </script>

    <script type="text/javascript" src="Powerup.js"> </script>
    <script type="text/javascript" src="Shot.js"> </script>
    <script type="text/javascript" src="EnemyShot.js"> </script>
    <script type="text/javascript" src="Ship.js"> </script>

    <script type="text/javascript">

      //
      // thanks for viewing the code, feel free to reuse.
      // if you do, please link to my site!  thanks!
      //
      var g_canvas;
      var g_context;
      var g_soundsLoaded;
      var g_isChr;
      var g_onscreenControls;
      var g_paused;
      var g_renderInterval;
      var g_clockInterval;

      var g_totalItems;
      var g_itemsLoaded;

      var g_background;
      var g_foreground;

      var g_ship;
      var g_gameState;
      var g_highScore;

      var g_powerups;
      var g_floatyText;
      var g_projectiles;
      var g_enemyProjectiles;
      var g_enemies;
      var g_afterEffects;
      var g_rainbow;

      var g_basicShotSound;
      var g_laserShotSound;
      var g_dinkSound;
      var g_smallExplodeSound;
      var g_bonusSound;
      var g_explodeSound;
      var g_artifact_chard_sound;
      var g_double_sound;
      var g_gem_sound;
      var g_gun_sound;
      var g_shot_sound;
      var g_speed_sound;

      var g_levelDirector;
      var g_shotsFired;
      var g_shotsRequired;
      var g_accuracy;
      var g_showAccuracy;
      var g_enemiesDestroyed;


      //
      // main() is called once the game has loaded and the user has clicked
      // on the "new game" button on the splash screen. This is a clean slate
      // with no registered timers or event listeners.
      //
      function main()
      {
         var level_1_loop = document.getElementById("level_1_loop");
         var bossLoop = document.getElementById("boss_loop");

         //dbg("engine = " + navigator.userAgent, false);
         g_rainbow = new Array("yellow", "orange", "white", "red");

         document.addEventListener('keydown', keyDown, false);
         document.addEventListener('keyup', keyUp, false);

         if ( g_basicShotSound == null )
         {

            g_basicShotSound = new Sound("basic_shot",5);
            g_laserShotSound = new Sound("laser",5);
            g_smallExplodeSound = new Sound("small_explode",5);
            g_bonusSound = new Sound("bonus_sound",4);
            g_explodeSound = new Sound("explode", 3);

            g_artifact_chard_sound = new Sound("artifact_chard_sound", 2);
            g_double_sound = new Sound("double_sound", 2);
            g_gem_sound = new Sound("gem_sound", 4);
            g_gun_sound = new Sound("gun_sound", 2);
            g_shot_sound = new Sound("shot_sound", 3);
            g_speed_sound = new Sound("speed_sound", 3);
         }

         g_highScore = 0;
         g_gameState = "setup";
         g_levelDirector = new LevelDirector();

         //
         // telling the level director to start will put the clock and
         // render loops on interval timers
         //
         g_levelDirector.startLevel();
      }

      //
      // map a sound name to a global audio object
      //
      function lookupSound(name)
      {
         if ( name == "double_sound" )
            return g_double_sound;
         else if ( name == "gem_sound" )
            return g_gem_sound;
         else if ( name == "gun_sound" )
            return g_gun_sound;
         else if ( name == "shot_sound" )
            return g_shot_sound;
         else if ( name == "speed_sound" )
            return g_speed_sound;

         dbg("Failed sound lookup: " + name, false);

         return null;
      }

      //
      // the level director will kick off an interval that calls
      // this function every 100ms 
      //
      function clockLoop()
      {
         if ( g_paused )
            return;

         g_levelDirector.myClock += 100;
         //dbg("Clock = " +  g_levelDirector.myClock, false);

         g_levelDirector.launchSorties();
         g_levelDirector.gameEvents();
      }

      //
      // the LevelDirector will kick off an interval that calls this function
      // which redraws the entire screen. that interval determines the game's
      // fps.
      //
      function renderLoop()
      { 
         if ( g_paused )
            return;

         g_background.render();
         g_ship.render();

         var remainingPowerups = new Array();
         for (var i = 0; i < g_powerups.length; ++i)
         {
            if (g_powerups[i].render())
            {
               remainingPowerups.push(g_powerups[i]);
            }
            else delete g_powerups[i];
         }
         delete g_powerups;
         g_powerups = remainingPowerups;

         var remainingText = new Array();
         for (var i = 0; i < g_floatyText.length; ++i)
         {
            if (g_floatyText[i].render())
            {
               remainingText.push(g_floatyText[i]);
            }
            else delete g_floatyText[i];
         }
         delete g_floatyText;
         g_floatyText = remainingText;

         var remainingEnemies = new Array();
         for (var i = 0; i < g_enemies.length; ++i)
         {
            if (g_enemies[i].render())
            {
               remainingEnemies.push(g_enemies[i]);
            }
            else delete g_enemies[i];
         }
         delete g_enemies;
         g_enemies = remainingEnemies;

         var remainingProjectiles = new Array();
         for (var i = 0; i < g_projectiles.length; ++i)
         {
            if (g_projectiles[i].render())
            {
               remainingProjectiles.push(g_projectiles[i]);
            }
            else delete g_projectiles[i];
         }
         delete g_projectiles;
         g_projectiles = remainingProjectiles;

         var remainingEnemyProjectiles = new Array();
         for (var i = 0; i < g_enemyProjectiles.length; ++i)
         {
            if (g_enemyProjectiles[i].render())
            {
               remainingEnemyProjectiles.push(g_enemyProjectiles[i]);
            }
            else delete g_enemyProjectiles[i];
         }
         delete g_enemyProjectiles;
         g_enemyProjectiles = remainingEnemyProjectiles;

         var remainingAfterEffects = new Array();
         for (var i = 0; i < g_afterEffects.length; ++i)
         {
            if (g_afterEffects[i].render())
            {
               remainingAfterEffects.push(g_afterEffects[i]);
            }
            else delete g_afterEffects[i];
         }
         delete g_afterEffects;
         g_afterEffects = remainingAfterEffects;

         g_levelDirector.renderSpecialText();

         g_foreground.render();

         if ( g_onscreenControls )
         {
            var ox = 40;
            var oy = 300;
            var ow = 30;

            var tx = 8;
            var ty = 22;

            g_context.fillStyle = "yellow";
            g_context.strokeStyle = "yellow";
            g_context.strokeRect(ox,oy,ow,ow);
            g_context.strokeRect(ox-35,oy+35,ow,ow);
            g_context.strokeRect(ox+35,oy+35,ow,ow);
            g_context.strokeRect(ox,oy+70,ow,ow);
            g_context.strokeRect(ox+520,oy+35,ow,ow);
            g_context.strokeRect(ox+270,oy+35,ow,ow);

            g_context.fillText("U",ox+tx,oy+ty);
            g_context.fillText("L", ox-35+tx,oy+35+ty);
            g_context.fillText("R", ox+35+tx,oy+35+ty);
            g_context.fillText("D", ox+tx,oy+70+ty);
            g_context.fillText("Z",ox+520+tx,oy+35+ty);
            g_context.fillText("P",ox+270+tx,oy+35+ty);
         }

         g_ship.renderPowers();
      }

      //--------------------------- BEGIN MUSIC LOOPING FUNCTIONS-------------//

      function playLoop(audioId, options)
      {
         var audio = document.getElementById(audioId);
         if (!audio)
         {
            return;
         }

         if (options && options.stop === true)
         {
            audio.loop = false;
            audio.pause();
            audio.currentTime = 0;
            return;
         }

         audio.loop = true;
         audio.volume = options && options.volume !== undefined ? options.volume : 1;
         if (audio.paused)
         {
            audio.currentTime = 0;
         }

         var playPromise = audio.play();
         if (playPromise && typeof playPromise.then === 'function')
         {
            playPromise.catch(function(){ /* autoplay guard */ });
         }
      }

      function start_level_1_loop(terminate)
      {
         if ( terminate != undefined )
         {
            var reason = terminate.toString();
            if ( reason == "boss" || reason == "gameover" )
            {
               playLoop("level_1_loop", { stop: true });
               return;
            }
         }

         playLoop("level_1_loop");
      }

      function startBossLoop(terminate)
      {
         if ( terminate != undefined && terminate.toString() == "end_boss")
         {
            playLoop("boss_loop", { stop: true });
            return;
         }

         playLoop("boss_loop");
      }


      function startLevel2Loop(terminate)
      {
         if ( terminate != undefined && terminate.toString() == "terminate")
         {
            playLoop("level_2_loop", { stop: true });
            return;
         }
         playLoop("level_2_loop");
      }

      //
      // write message to debug area
      //
      function dbg(str, append)
      {
         var dbgObj = document.getElementById("dbg");
         dbgObj.innerHTML = append? (dbgObj.innerHTML + str): str;
      }

      //
      // appends all game sounds to the document. called after the loading
      // screen itself is loaded.  The GameSounds.php file does a base64_encode
      // on the actual .ogg files residing on the server.  This is so the sound
      // objects can be repeatedly re-initialized without a network hit. This
      // is part of a workaround for Chrome because that browser does not 
      // correctly re-play short audio sounds (which is just about every sound
      // effect in the game)
      //
      function loadGameSounds()
      {
          g_soundsLoaded = true;
      }

      function pause()
      {
         if (g_paused == null )
            g_paused = false;

         g_paused = !g_paused;

         if ( g_paused )
            dbg("Game Paused", false);
         else
            dbg("", false);
      }


    </script>
  </head>

  <!--- bodyLoaded() follows resource loading and starts the splash screen 
                     and can be found in the Loader.js file --->

  <body onload="bodyLoaded();">

  <div id="game-wrapper">
    <table cellpadding="0" cellspacing="0" border="0" frame="void">
      <tr>
        <td valign="top">

          <canvas align="left" id="theCanvas" width="600" height="400">
          <h2 align="center">
          Firefox, Opera, Chrome or any modern HTML5 compliant browser required.
          <br>
          </h2>
          <h3>
          <p align="center">
          This site requires a current browser for graphics and sound effects.
          <br><br>
          Download a compatible browser from one of the links below:
          <br>

          <a href="http://www.mozilla.com/en-US/firefox/firefox.html">Firefox</a>
          <br>
          <a href="http://www.opera.com/">Opera</a><br>
          <a href="http://www.google.com/chrome">Chrome</a>
          </h3>
          </canvas>
        </td>
      </tr>
    </table>
  </div>
  <div id="dbg"></div>

   <!--- put all of the game objects into the document which makes writing
         the load screen pretty trivial; a really simple loader.  as items
         load they call the itemLoaded() function which updates the load screen.
         Just remember to make this div small and hidden. --->

      
  <div id="hidden">

    <img    id="splash_screen" 
            src="splash_screen.jpg" 
            alt=""
            onload="itemLoaded(this);">

    <img    id="loading" 
            src="loading.png" 
            alt=""
            onload="itemLoaded(this);">

    <img    id="title" 
            src="title.png" 
            alt=""
            onload="itemLoaded(this);">

<!--[if !IE]> <-->
    <audio  id="loading_music" 
            src="loading_music.ogg"
            autoplay="autoplay" loop>

    </audio>

    <audio  id="level_1_preloop" 
            src="level_1_preloop.ogg" 
            autobuffer='true'>
    </audio>

    <audio  id="level_1_loop" 
            src="level_1_loop.ogg" 
            autobuffer='true' loop>
    </audio>

    <audio  id="level_2_loop" 
            src="level_2_loop.ogg" 
            autobuffer='true' loop>
    </audio>

    <audio  id="level_passed" 
            src="level_passed.ogg" 
            autobuffer='true'>
    </audio>

    <audio  id="boss_loop" 
            src="boss_loop.ogg" 
            autobuffer='true' loop>
    </audio>
<!--> <![endif]-->

    <img    id="starfield"
            src="starfield.jpg"
            alt=""
            onload="itemLoaded(this);">

    <img    id="foreground"
            src="foreground.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_center"
            src="ship_center.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_up_1"
            src="ship_up_1.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_up_2"
            src="ship_up_2.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_up_3"
            src="ship_up_3.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_down_1"
            src="ship_down_1.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_down_2"
            src="ship_down_2.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_down_3"
            src="ship_down_3.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_icon"
            src="ship_icon.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="foreground_light"
            src="foreground_light.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="sky"
            src="sky.jpg"
            alt=""
            onload="itemLoaded(this);">

    <img    id="speed_image"
            src="speed_image.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="gun_image"
            src="gun_image.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="shot_image"
            src="shot_image.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="double_image"
            src="double_image.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="gem_image"
            src="gem_image.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_small"
            src="enemy_small.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_small_special"
            src="enemy_small_special.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_small_2"
            src="enemy_small_2.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_small_2_special"
            src="enemy_small_2_special.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_small_3"
            src="enemy_small_3.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_small_4"
            src="enemy_small_4.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_small_4_special"
            src="enemy_small_4_special.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_artifact"
            src="enemy_artifact.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="enemy_artifact_2"
            src="enemy_artifact_2.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_death_1"
            src="ship_death_1.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_death_2"
            src="ship_death_2.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_death_3"
            src="ship_death_3.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_death_4"
            src="ship_death_4.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_death_5"
            src="ship_death_5.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_death_6"
            src="ship_death_6.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="ship_death_7"
            src="ship_death_7.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="splode_1"
            src="splode_1.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="splode_2"
            src="splode_2.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="splode_3"
            src="splode_3.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="splode_4"
            src="splode_4.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="splode_5"
            src="splode_5.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="splode_6"
            src="splode_6.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="splode_7"
            src="splode_7.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="artifact_chard_image"
            src="artifact_chard.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="artifact_skull_image"
            src="artifact_skull.png"
            alt=""
            onload="itemLoaded(this);">

    <img    id="command_ship"
            src="command_ship.png"
            alt=""
            onload="itemLoaded(this);">


   </div> <!--- end hidden dev that contains all game graphics/sound --->

  </body>
</html>
